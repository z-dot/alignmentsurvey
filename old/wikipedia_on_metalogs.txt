[[File:STP metalog.png|thumb|Three-term metalog distributions|upright=1.35]]
[[File:4 term metalog.png|thumb|Four-term metalog distribution when <math>a_3=0</math>|upright=1.35]]
The '''metalog distribution''' is a flexible [[continuous probability distribution]] designed for ease of use in practice. Together with its transforms, the metalog family of continuous distributions is unique because it embodies ''all'' of following properties: virtually unlimited shape flexibility; a choice among unbounded, semi-bounded, and bounded distributions; ease of fitting to data with linear least squares; simple, closed-form [[quantile function]] (inverse [[Cumulative distribution function|CDF]]) equations that facilitate [[Inverse transform sampling|simulation]]; a simple, closed-form [[Probability density function|PDF]]; and Bayesian updating in closed form in light of new data. Moreover, like a [[Taylor series]], metalog distributions may have any number of terms, depending on the degree of shape flexibility desired and other application needs.

Applications where metalog distributions can be useful typically involve fitting empirical data, simulated data, or [[Expert elicitation|expert-elicited]] quantiles to smooth, continuous probability distributions. Fields of application are wide-ranging, and include economics, science, engineering, and numerous other fields. The metalog distributions, also known as the Keelin distributions, were first published in 2016<ref name=":0">{{Cite journal|last=Keelin|first=Thomas W.|date=2016|title=The Metalog Distributions|url=https://pubsonline.informs.org/doi/10.1287/deca.2016.0338|journal=Decision Analysis|volume=13|issue=4|pages=243–277|doi=10.1287/deca.2016.0338|issn=1545-8490|archive-url=http://www.metalogdistributions.com/images/The_Metalog_Distributions_-_Keelin_2016.pdf|archive-date=2016-11-28|url-access=subscription}}</ref> by Tom Keelin.<ref>{{Cite web|title=About the Author|url=http://www.metalogdistributions.com/about.html|access-date=2021-02-13|website=www.metalogdistributions.com}}</ref>

== History ==
The history of [[probability distribution]]s can be viewed, in part, as a progression of developments towards greater flexibility in shape and bounds when [[Probability distribution fitting|fitting to data]].  The [[normal distribution]] was first published in 1756,<ref>De Moivre, A. (1756). The doctrine of chances: or, A method of calculating the probabilities of events in play (Vol. 1). Chelsea Publishing Company.</ref> and [[Bayes’ theorem]] in 1763.<ref>Bayes, T. (1763). LII. An essay towards solving a problem in the doctrine of chances. By the late Rev. Mr. Bayes, FRS communicated by Mr. Price, in a letter to John Canton, AMFR S. Philosophical transactions of the Royal Society of London, (53), pp. 370–418. </ref>  The normal distribution laid the foundation for much of the development of classical statistics. In contrast, Bayes' theorem laid the foundation for the state-of-information, [[Probability interpretations#Subjectivism|belief-based]] probability representations.  Because belief-based probabilities can take on any shape and may have natural bounds, probability distributions flexible enough to accommodate both were needed. Moreover, many empirical and experimental data sets exhibited shapes that could not be well matched by the normal or [[List of probability distributions|other continuous distributions]]. So began the search for continuous probability distributions with flexible shapes and bounds.

Early in the 20th century, the [[Pearson distribution|Pearson]]<ref>Johnson NL, Kotz S, Balakrishnan N. Continuous univariate distributions, Vol 1, Second Edition, John Wiley & Sons, Ltd, 1994, pp. 15–25.</ref> family of distributions, which includes the [[normal distribution|normal]], [[beta distribution|beta]], [[continuous uniform distribution|uniform]], [[gamma distribution|gamma]], [[student t-distribution|student-t]], [[chi-square distribution|chi-square]], [[F distribution|F]], and five others,<ref>Ord, J.K., 1972. Families of frequency distributions. Charles Griffin & Co, Ltd, London. Table 1.1, p 6.</ref> emerged as a major advance in shape flexibility. These were followed by the [[Norman Lloyd Johnson|Johnson]]<ref>{{cite journal | url=https://www.jstor.org/stable/2332539 | jstor=2332539 | title=Systems of Frequency Curves Generated by Methods of Translation | last1=Johnson | first1=N. L. | journal=Biometrika | year=1949 | volume=36 | issue=1/2 | pages=149–176 | doi=10.2307/2332539 | pmid=18132090 | url-access=subscription }}</ref><ref>{{cite journal | url=https://www.jstor.org/stable/2335422 | jstor=2335422 | title=Systems of Frequency Curves Generated by Transformations of Logistic Variables | last1=Tadikamalla | first1=Pandu R. | last2=Johnson | first2=Norman L. | journal=Biometrika | year=1982 | volume=69 | issue=2 | pages=461–465 | doi=10.1093/biomet/69.2.461 | url-access=subscription }}</ref> distributions. Both families can represent the first four moments of data ([[mean]], [[variance]], [[skewness]], and [[kurtosis]]) with smooth continuous curves. However, they have no ability to match fifth or higher-order moments. Moreover, for a given skewness and kurtosis, there is no choice of bounds. For example, matching the first four moments of a data set may yield a distribution with a negative lower bound, even though it might be known that the quantity in question cannot be negative. Finally, their equations include intractable integrals and complex statistical functions, so that fitting to data typically requires iterative methods.

Early in the 21st century, [[decision analysis|decision analysts]] began working to develop continuous probability distributions that would exactly fit any specified three points on the [[cumulative distribution function]] for an uncertain quantity (e.g., expert-elicited <math>0.10, 0.50</math>, and <math>0.90</math> quantiles). The Pearson and the Johnson family distributions were generally inadequate for this purpose. In addition, decision analysts also sought probability distributions that would be easy to parameterize with data (e.g., by using [[linear least squares]], or equivalently, multiple [[linear regression]]). Introduced in 2011, the class of [[quantile-parameterized distribution]]s (QPDs) accomplished both goals. While being a significant advance for this reason, the QPD originally used to illustrate this class of distributions, the Simple Q-Normal distribution,<ref name="KeelinPowley">{{Cite journal|last1=Keelin|first1=Thomas W.|last2=Powley|first2=Bradford W.|date=2011-08-04|title=Quantile-Parameterized Distributions|url=https://pubsonline.informs.org/doi/abs/10.1287/deca.1110.0213|journal=Decision Analysis|volume=8|issue=3|pages=206–219|doi=10.1287/deca.1110.0213|issn=1545-8490|archive-url=http://www.metalogdistributions.com/images/KeelinPowley_QuantileParameterizedDistributions_2011.pdf|archive-date=2011-09-01|url-access=subscription}}</ref> had less shape flexibility than the Pearson and Johnson families, and lacked the ability to represent semi-bounded and bounded distributions. Shortly thereafter, Keelin<ref name=":0" /> developed the family of metalog distributions, another instance of the QPD class, which is more shape-flexible than the Pearson and Johnson families, offers a choice of boundedness, has closed-form equations that can be fit to data with linear least squares, and has closed-form [[quantile function]]s, which facilitate [[Monte Carlo method|Monte Carlo simulation]].

==Definition and quantile function==
The metalog distribution is a generalization of the [[logistic distribution]], where the term "metalog" is short for "metalogistic". Starting with the logistic [[quantile function]], <math>x=Q(y)=\mu+s\mbox{ } \ln\Bigl({y\over{1-y}}\Bigr)</math>, Keelin substituted power series expansions in cumulative probability <math>y=F(x)</math> for the <math>\mu</math> and the <math>s</math> parameters, which control location and scale, respectively.<ref name="Kee">[http://www.metalogdistributions.com/images/The_Metalog_Distributions_-_Keelin_2016.pdf Keelin TW (2016). "The Metalog Distributions." Decision Analysis. 13 (4): 243–277.]</ref>

:<math>\mu =a_1 + a_4(y -0.5) + a_5(y -0.5)^2 + a_7(y -0.5)^3 + a_9(y -0.5)^4 + \dots </math>
:<math>s   =a_2 + a_3(y -0.5) + a_6(y -0.5)^2 + a_8(y -0.5)^3 + a_{10}(y -0.5)^4 + \dots </math>

Keelin's rationale for this substitution was fivefold.<ref name="Kee"/> First, the resulting quantile function would have significant shape flexibility, governed by the coefficients <math>a_i</math>. Second, it would have a simple closed form that is linear in these coefficients, implying that they could easily be determined from [[Cumulative distribution function|CDF]] data by [[linear least squares]]. Third, the resulting quantile function would be smooth, differentiable, and [[Analytic function|analytic]], ensuring that a smooth, closed-form [[probability density function|PDF]] would be available. Fourth, [[inverse transform sampling|simulation]] would be facilitated by the resulting closed-form [[Quantile function|inverse CDF]]. Fifth, like a [[Taylor series]], any number of terms <math>k</math> could be used, depending on the degree of shape flexibility desired and other application needs.

Note that the subscripts of the <math>a</math>-coefficients are such that <math>a_1</math> and <math>a_4</math> are in the <math>\mu</math> expansion, <math>a_2</math> and <math>a_3</math> are in the <math>s</math> expansion, and subscripts alternate thereafter. This ordering was chosen so that the first two terms in the resulting metalog quantile function correspond to the logistic distribution exactly; adding a third term with <math>a_3 \neq 0</math> adjusts skewness; adding a fourth term with <math>a_4 \neq 0</math> adjusts kurtosis primarily; and adding subsequent non-zero terms yields more nuanced shape refinements.<ref name="Kee" />{{rp|p.252}}

Rewriting the logistic quantile function to incorporate the above substitutions for <math>\mu</math> and <math>s</math> yields the metalog [[quantile function]], for cumulative probability <math>0<y<1</math>.
:<math>
M_k(y)= \left\{
\begin{array}{ll}
a_1+a_2\ln\Bigl({y\over{1-y}}\Bigr) & \mbox{for } k=2\\
a_1+a_2\ln\Bigl({y\over{1-y}}\Bigr)+a_3(y-0.5) \ln \Bigl({y\over{1-y}}\Bigr) & \mbox{for } k=3\\
a_1+a_2\ln\Bigl({y\over{1-y}}\Bigr)+a_3(y-0.5) \ln \Bigl({y\over{1-y}}\Bigr)+a_4(y-0.5) & \mbox{for } k=4\\
M_{k-1}(y)+a_k(y-0.5)^{k-1\over2} & \mbox{for odd } k\geq5\\
M_{k-1}(y)+a_k(y-0.5)^{{k\over2}-1}\ln\Bigl({y\over{1-y}}\Bigr) & \mbox{for even } k\geq6\\
\end{array}\right.
</math>

Equivalently, the metalog quantile function can be expressed in terms of basis functions: <math> M_k(y) =  \sum_{i=1}^k a_i g_i(y)</math>, where the metalog basis functions are <math> g_1(y)=1,\mbox{ } g_2(y)=\ln\Bigl({y\over{1 -y}}\Bigr),</math> and each subsequent <math>g_i(y)</math> is defined as the expression that is multiplied by <math>a_i</math> in the equation for <math> M_k(y)</math> above. Note that coefficient <math>a_1</math> is the [[median]], since all other terms equal zero when <math>y=0.5</math>. Special cases of the metalog quantile function are the [[logistic distribution]] (<math>k=2</math>) and the [[continuous uniform distribution|uniform distribution]] (<math>k\geq4,a_1 = 0.5,a_4 =1,a_i =0</math> otherwise).

==Probability density function==
Differentiating <math>x=M_k(y)</math> with respect to <math>y</math> yields the quantile density function<ref>Parzen, E., 1979, Nonparametric statistical data modeling, Journal of the American Statistical Association,7, 105–131</ref> <math>q(y)=dx/dy</math>. The reciprocal of this quantity, <math>(q(y))^{-1}=dy/dx=f(Q(y))</math>, is the [[probability density function]] expressed as a p-PDF,<ref name=":1">p-PDF: A [[probability density function]] expressed as a function of cumulative probability <math>y</math> rather than variable of interest <math>x</math>; equivalently, a "density quantile function" as defined by Parzen, E., 1979, Nonparametric statistical data modeling, Journal of the American Statistical Association,7, 105–131</ref>

:<math>
m_k(y)= \left\{
\begin{array}{ll}
{y(1-y)\over{a_2}}  & \mbox{for } k=2\\
\Bigl({a_2\over{y(1-y)}}+a_3\Bigl({y-0.5\over{y(1-y)}}+\ln{y\over{1-y}}\Bigr)\Bigr)^{-1} & \mbox{for } k=3\\
\Bigl({a_2\over{y(1-y)}}+a_3\Bigl({y-0.5\over{y(1-y)}}+\ln{y\over{1-y}}\Bigr)+a_4\Bigr)^{-1} & \mbox{for } k=4\\
\Bigl({1\over{m_{k-1}(y)}}+a_k{k-1\over2}(y-0.5)^{(k-3)/2}\Bigr)^{-1} & \mbox{for odd } k\geq5\\
\Bigl({1\over{m_{k-1}(y)}}+a_k\Bigl({(y-0.5)^{k/2-1}\over{y(1-y)}}+({k\over2}-1)(y-0.5)^{(k/2-2)}\ln{y\over{1-y}}\Bigr)\Bigr)^{-1} & \mbox{for even } k\geq6,\\
\end{array}\right.
</math>
which may be equivalently expressed in terms of basis functions as

: <math>m_k(y) = \left( \sum_{i=1}^k
 a_i {{d g_i(y)}\over{dy}} \right)^{-1}</math> where <math>0<y<1</math>.
Note that this PDF is expressed as a function of cumulative probability, <math>y</math>, rather than variable of interest, <math>x</math>. To plot the PDF (e.g., as shown in the figures on this page), one can vary <math>y\in(0,1)</math> parametrically, and then plot <math>x=M_k(y)</math> on the horizontal axis and <math>m_k(y)</math> on the vertical axis.

Based on the above equations and the following transformations that enable a choice of bounds, the family of metalog distributions is composed of unbounded, semibounded, and bounded metalogs, along with their symmetric-percentile triplet (SPT) special cases.

==Unbounded, semi-bounded, and bounded metalog distributions==
As defined above, the metalog distribution is unbounded, except in the unusual special case where <math>a_i = 0</math> for all terms that contain <math>\ln\Bigl({y\over{1-y}}\Bigr)</math>. However, many applications require flexible probability distributions that have a lower bound <math>b_l</math>, an upper bound <math>b_u</math>, or both. To meet this need, Keelin used transformations to derive semi-bounded and bounded metalog distributions.<ref name=":0" /> Such transformations are governed by a general property of quantile functions: for any [[quantile function]] <math>x=Q(y)</math> and increasing function <math>z(x), x=z^{-1} (Q(y))</math> is also a [[quantile function]].<ref name=":2" /> For example, the [[quantile function]] of the [[normal distribution]] is <math>x=\mu+\sigma \Phi^{-1} (y)</math>; since the [[natural logarithm]], <math>z(x)=\ln(x-b_l)</math>, is an increasing function, <math>x=b_l+e^{\mu+\sigma \Phi^{-1} (y)}</math> is the [[quantile function]] of the [[Log-normal distribution|lognormal distribution]]. Analogously, applying this property to the metalog quantile function <math>M_k(y)</math> using the transformations below yields the semi-bounded and bounded members of the metalog family. By considering <math>z(x)</math> to be metalog-distributed, all members of the metalog family meet Keelin and Powley's<ref name="KeelinPowley"/> definition of a [[quantile-parameterized distribution]] and thus possess the properties thereof.
:<math>
\begin{array}{l|c|c|c|c|c}
& & & & & \mbox{shape}\\
& \mbox{transformation} & \mbox{quantile function} & \mbox{PDF} & \mbox{where} &\mbox{parameters}\\
\hline
\mbox{Metalog (unbounded)} & z(x)=x & M_k(y) & m_k(y) & 0<y<1 & k-2\\
\hline
\mbox{Log metalog} & z(x)=\ln(x-b_l) & M_k^{\log} (y)=b_l+e^{M_k(y)} & m_k^{\log}(y)=m_k(y)e^{-M_k(y)}  &  0<y<1 & k-1\\
\mbox{(bounded below)} && =b_l & =0  &  y=0\\
\hline
\mbox{Negative-log metalog} & z(x)=-\ln(b_u-x) & M_k^\operatorname{nlog}(y)=b_u-e^{-M_k(y)} & m_k^\operatorname{nlog}(y) = m_k(y)e^{M_k(y)}& 0<y<1 & k-1\\
\mbox{(bounded above)} && =b_u & =0  &  y=1\\
\hline
\mbox{Logit metalog} & z(x)=\ln\Bigl({x-b_l\over{b_u-x}}\Bigr) & M_k^\operatorname{logit}(y)={b_l+b_u e^{M_k(y)}\over{1+e^{M_k(y)}}} & m_k^\operatorname{logit}(y)=m_k(y){\bigl(1+e^{M_k(y)}\bigr)^2\over{(b_u-b_l)e^{M_k(y)}}}  &  0<y<1 & k\\
\mbox{(bounded)}&&=b_l & =0  &  y=0\\
& & =b_u & =0  &  y=1
\end{array}
</math>
Note that the number of [[shape parameter]]s in the metalog family increases linearly with the number of terms <math>k</math>. Therefore, any of the above metalogs may have any number of shape parameters. By contrast, the Pearson and Johnson families of distributions are limited to two shape parameters.

== SPT metalog distributions ==
[[File:Bounded SPT Metalog v3.gif|thumb|Bounded SPT metalog parameterized with CDF data <math>(20, 0.1), (30, 0.5),</math> and <math>(50, 0.9)</math> and with lower and upper bounds <math>0</math> and <math>100</math> respectively.|480x480px]]
The symmetric-percentile triplet (SPT) metalog distributions are a three-term <math>(k=3)</math> special case of the unbounded, semi-bounded, and bounded metalog distributions.<ref name="SPT">{{Cite journal |doi=10.1287/deca.2016.0338 |title=The Metalog Distributions |year=2016 |last1=Keelin |first1=Thomas W. |journal=Decision Analysis |volume=13 |issue=4 |pages=243–277 }}</ref> These are parameterized by the three <math>(x,y)</math> points off the [[Cumulative distribution function|CDF curve]], of the form <math>(x_1,\alpha)</math>, <math>(x_2,0.5)</math>, and <math>(x_3,1-\alpha)</math>, where <math>0 <\alpha<0.5</math>. SPT metalogs are useful when, for example, quantiles <math>(x_1,x_2,x_3)</math> corresponding to the CDF probabilities (e.g. <math>0.1, 0.5, 0.9</math>) are elicited from an expert and used to parameterize the three-term metalog distributions. As noted below, certain mathematical properties are simplified by the SPT parameterization.

== Properties ==
The metalog family of probability distributions has the following properties.

=== Feasibility ===
A function of the form of <math>M_k(y)</math> or any of its above transforms is a feasible probability distribution [[if and only if]] its PDF is greater than zero for all <math>y \in (0,1).</math><ref name="KeelinPowley"/> This implies a feasibility constraint on the set of coefficients <math>\boldsymbol a=(a_1,...,a_k) \in \R^k</math>,

: <math>m_k(y)>0</math> for all <math>y \in (0,1)</math>.

In practical applications, feasibility must generally be checked rather than assumed. For <math>k=2</math>, <math>a_2>0</math> ensures feasibility. For <math>k=3</math> (including SPT metalogs), the feasibility condition is <math>a_2>0</math> and <math>{|a_3|/a_2}<1.66711</math>.<ref name="SPT" /> For <math>k=4</math>, a similar closed form has been derived.<ref>{{Cite web|title=The Metalog Distributions Feasibility|url=http://www.metalogdistributions.com/equations/feasibility.html|access-date=2021-02-13|website=www.metalogdistributions.com}}</ref> For <math>k\geq5</math>, feasibility is typically checked graphically or numerically.

The unbounded metalog and its above transforms share the same set of feasible coefficients.<ref>[http://metalogdistributions.com/images/Powley_Dissertation_2013-augmented.pdf Powley, B.W. (2013). “Quantile Function Methods For Decision Analysis”. Corollary 12, p 30. PhD Dissertation, Stanford University]</ref> Therefore, for a given set of coefficients, confirming that <math>m_k(y)>0</math> for all <math>y \in (0,1)</math> is sufficient regardless of the transform in use.

=== Convexity ===
The set of feasible metalog coefficients <math>S_\boldsymbol a=\{\boldsymbol a\in\R^k |m_k(y) > 0</math>  for  all <math>y\in (0,1)\}</math> is [[Convex set|convex]]. Because [[convex optimization]] problems require convex feasible sets, this property can simplify optimization problems involving metalogs. Moreover, this property guarantees that any [[convex combination]] of the <math>\boldsymbol a</math> vectors of feasible metalogs is feasible, which is useful, for example, when combining the opinion of multiple experts<ref name="KeelinHoward">[https://osf.io/xdg5e/ Keelin, Thomas W., and Ronald A. Howard. (2021). “The Metalog Distributions: Virtually Unlimited Shape Flexibility, Combining Expert Opinion in Closed Form, and Bayesian Updating in Closed Form.” OSF Preprints. doi:10.31219/osf.io/xdg5e.]</ref> or interpolating among feasible metalogs.<ref name="sumLog">[https://dl.acm.org/doi/abs/10.5555/3400397.3400643 Keelin, T.W., Chrisman, L. and Savage, S.L. (2019). “The metalog distributions and extremely accurate sums of lognormals in closed form.” WSC '19: Proceedings of the Winter Simulation Conference. 3074–3085.]</ref>  By implication, any probabilistic [[Mixture model|mixture]] of metalog distributions is itself a metalog.

=== Fitting to data ===
[[File:Gauge height.png|thumb|10-term log metalog distribution over maximum annual river gauge height (ft) from 1920 to 2014 for the Williamson River below Sprague River confluence, Chiloquin, Oregon. Data source: [[USGS]].|484x484px]]
The coefficients <math>\boldsymbol a</math> can be determined from data by [[linear least squares]]. Given <math>n</math> data points <math>(x_i,y_i)</math> that are intended to characterize a metalog CDF, and an <math>n \times k</math> matrix <math>\boldsymbol Y</math> whose elements consist of the basis functions <math>g_j (y_i)</math>, then as long as <math>\boldsymbol Y^T \boldsymbol Y</math> is invertible, the column vector <math>\boldsymbol a</math> of the coefficients <math>a_i</math> is given by <math>\boldsymbol a=(\boldsymbol Y^T \boldsymbol Y)^{-1} \boldsymbol Y^T \boldsymbol z</math>, where <math>n\geq k</math> and column vector <math>\boldsymbol z=(z(x_1),\ldots,z(x_n))</math>. If <math>n=k</math>, this equation reduces to <math>\boldsymbol a=\boldsymbol Y^{-1} \boldsymbol z</math>, where the resulting metalog CDF runs through all data points exactly. For SPT metalogs, it further reduces to expressions in terms of the three <math>(x_i,y_i)</math> points directly.<ref name="SPT" />

An alternate fitting method, implemented as a linear program, determines the coefficients by minimizing the sum of absolute distances between the CDF and the data, subject to feasibility constraints.<ref name="Faber">[https://searchworks.stanford.edu/view/13257318 Faber, I.J. (2019). Cyber Risk Management: AI-generated Warnings of Threats (Doctoral dissertation, Stanford University).]</ref>
[[File:StdNormalPDF11.gif|thumb|How metalogs converge to standard normal distribution as <math>k</math> increases from 2 to 10|480x480px]]
[[File:Weibull metalogs.png|thumb|Weibull distributions (blue) closely approximated by nine-term semi-bounded metalog distributions (dashed, yellow)|480x480px]]

=== Shape flexibility ===
According to the metalog flexibility theorem,<ref name="KeelinHoward"/> any probability distribution with a continuous quantile function can be approximated arbitrarily closely by a metalog. Moreover, in the original paper, Keelin showed that ten-term metalog distributions parameterized by 105 CDF points from 30 traditional source distributions (including the normal, student-t, lognormal, gamma, beta, and extreme-value distributions) approximate each such source distribution within a [[Kolmogorov–Smirnov test|K-S]] distance of 0.001 or less.<ref name="conv">{{cite journal | url=https://doi.org/10.1287/deca.2016.0338 | doi=10.1287/deca.2016.0338 | title=The Metalog Distributions | year=2016 | last1=Keelin | first1=Thomas W. | journal=Decision Analysis | volume=13 | issue=4 | pages=243–277 | url-access=subscription }}</ref> Thus, metalog shape flexibility is virtually unlimited.

The animated figure on the right illustrates this for the standard normal distribution, where metalogs with various numbers of terms are parameterized by the same set of 105 points from the standard normal CDF. The metalog PDF converges to the standard normal PDF as the number of terms increases. With two terms, the metalog approximates the normal with a logistic distribution. With each increment in number of terms, the fit gets closer. With 10 terms, the metalog PDF and standard normal PDF are visually indistinguishable.

Similarly, nine-term semi-bounded metalog PDFs with <math>b_l=0</math> are visually indistinguishable from a range of [[Weibull distribution]]s. The six cases shown to the right correspond to Weibull shape parameters 0.5, 0.8, 1.0, 1.5, 2, and 4. In each case, the metalog is parameterized by the nine <math>x</math> points from the Weibull CDF that correspond to the cumulative probabilities <math>y = (0.001, 0.02, 0.10, 0.25, 0.5, 0.75, 0.9, 0.98, 0.999)</math>.

Such convergence is not unique to the normal and Weibull distributions. Keelin originally showed analogous results for a wide range of distributions<ref name="conv" /> and has since provided further illustrations.<ref name="KeelinHoward"/><ref>{{Cite web|title=Metalog Distributions Shape Flexibility|url=http://www.metalogdistributions.com/shapeflexibility.html|access-date=2021-02-13|website=www.metalogdistributions.com}}</ref>

=== Median ===
The median of any distribution in the metalog family has a simple closed form. Note that <math>
y=0.5</math> defines the median, and <math>M_k(0.5)=a_1</math> (since all subsequent terms are zero for <math>
y=0.5</math>). It follows that the medians of the unbounded metalog, log metalog, negative-log metalog, and logit metalog distributions are <math>a_1</math>, <math>b_l+e^{a_1}</math>, <math>b_u-e^{-a_1}</math>, and <math>{b_l+b_u e^{a_1}\over{1+e^{a_1}}}</math>, respectively.

===Moments===
The <math>m^{th}</math> moment of the unbounded metalog distribution, <math>E[x^m] =\int_{y=0}^1 {M_k(y)}^m \, dy</math>, is a special case of the more general formula for QPDs.<ref name="KeelinPowley"/> For the unbounded metalog, such integrals evaluate to closed-form moments that are <math>m^{th}</math> order polynomials in the coefficients <math>a_i</math>. The first four central moments of the four-term unbounded metalog are:
:<math>
\begin{align}
\text{mean} = {} & a_1 +{a_3\over2}\\[6pt]
\text{variance} = {} &
\pi^2{{a_2}^2\over3}+{{a_3}^2\over{12}}+\pi^2{{a_3}^2\over{36}}+a_2a_4
+{{a_4}^2\over{12}}\\[6pt]
\text{skewness} = {} & \pi^2 {a_2}^2{a_3}+\pi^2 {{a_3}^3 \over{24}} + {{{a_2} {a_3} {a_4}} \over{2}}+ \pi^2{{{a_2} {a_3} {a_4}} \over{6}} + {{{a_3} {a_4}^2} \over{8}}\\[6pt]
\text{kurtosis} = {} & 7\pi^4 {{a_2}^4\over{15}}+3\pi^2 {{{a_2}^2{a_3}^2}
\over{24}}+7\pi^4 {{{a_2}^2{a_3}^2} \over{30}}+{{{a_3}^4}\over{80}} +
\pi^2{{a_3}^4  \over{24}} + 7\pi^4 {{a_3}^4\over{1200}} + 2\pi^2{a_2}^3{a_4}\\[6pt]
& {} +{{{a_2} {a_3}^2 {a_4}} \over{2}}+2\pi^2{{{a_2}
{a_3}^2 {a_4}} \over{3}}+2{{a_2}^2 {a_4}^2}+\pi^2{{{a_2}^2 {a_4}^2 }
\over{6}}+{{{a_3}^2 {a_4}^2 } \over{8}}+\pi^2{{{a_3}^2 {a_4}^2 } \over{40}}+{{{a_2} {a_4}^3 } \over{3}} +{{a_4}^4  \over{80}} \end{align} </math>
Moments for fewer terms are subsumed in these equations. For example, moments of the three-term metalog can be obtained by setting <math>a_4</math> to zero. Moments for metalogs with more terms, and higher-order moments (<math>m>4</math>), are also available.<ref>{{Cite web|title=The Metalog Distribution Moments|url=http://www.metalogdistributions.com/moments.html|access-date=2021-02-13|website=www.metalogdistributions.com}}</ref> Moments for semi-bounded and bounded metalogs are not available in closed form.

=== Parameterization with moments ===
Three-term unbounded metalogs can be parameterized in closed form with their first three [[central moment]]s. Let <math>m, v,</math> and <math>s</math> be the mean, variance, and skewness, and let <math>s_s</math> be the standardized skewness, <math>s_s=s/v^{3/2}</math>.  Equivalent expressions of the moments in terms of coefficients, and coefficients in terms of moments, are as follows:

:<math>
\begin{array}{ll}
m =  a_1 +{a_3\over2} && a_1 = m -{a_3\over2}\\[6pt]
v =
\pi^2{{a_2}^2\over3}+{{a_3}^2\over{12}}+\pi^2{{a_3}^2\over{36}} &&
a_2 = {1\over{\pi}}\Bigl[3\Bigl(v-\Bigl({1\over{12}}+{{\pi}^2\over{36}}\Bigr){a_3}^2\Bigr)\Bigr]^{1\over{2}} \\[6pt]
s = \pi^2 {a_2}^2{a_3}+\pi^2 {{a_3}^3 \over{24}} &&
a_3 = 4\Bigl({6v\over{6+\pi^2}}\Bigr)^{1\over{2}}\cos\Bigl[{1\over{3}}\Bigl(\cos^{-1}\Bigl(-{s_s\over{4}}\Bigl(1+{{\pi}^2\over{6}}\Bigr)^{1\over{2}}\Bigr)+4\pi\Bigr)\Bigr]
\\[6pt]
 \end{array} </math>

The equivalence of these two sets of expressions can be derived by noting that the moments equations on the left determine a cubic polynomial in terms of the coefficients <math>a_1, a_2,</math> and <math>a_3</math>, which can be solved in closed form as functions of <math>m, v,</math> and <math>s</math>. Moreover, this solution is unique.<ref name="equiv">{{Cite web|title=Equivalence of coefficients' and moments' parameterizations of three-term metalog|url=http://www.metalogdistributions.com/n3momentsparameters.html|access-date=2021-03-28|website=www.metalogdistributions.com}}</ref> In terms of moments, the feasibility condition is <math>|s_s|\leq 2.07093</math>, which can be shown to be equivalent to the following feasibility condition in terms of the coefficients: <math>a_2>0</math>; and <math>{|a_3|/a_2}<1.66711</math>.<ref name="equiv"/>

This property can be used, for example, to represent the sum of independent, non-identically distributed [[random variable]]s. Based on [[cumulant]]s, it is known that for any set of independent random variables, the mean, variance, and skewness of the sum are the sums of the respective means, variances, and skewnesses. Parameterizing a three-term metalog with these central moments yields a continuous distribution that exactly preserves these three moments, and accordingly provides a reasonable approximation to the shape of the distribution of the sum of independent random variables.

===Simulation===
Since their [[quantile function]]s are expressed in closed form, metalogs facilitate [[Monte Carlo method|Monte Carlo simulation]]. Substituting uniformly distributed random samples of <math>y</math> into the Metalog [[Quantile function|quantile function (inverse CDF)]] produces random samples of <math>x</math> in closed form, thereby eliminating the need to invert a CDF. See below for simulation applications.

===Eliciting and Combining Expert Opinion===
Due to their shape flexibility, metalog distributions can be an attractive choice for eliciting and representing expert opinion.<ref name="statCan">[https://library.oapen.org/bitstream/handle/20.500.12657/42565/2020_Book_DevelopmentsInDemographicForec.pdf?sequence=1#page=51 Dion, P., Galbraith, N., Sirag, E. (2020). “Using expert elicitation to build long-term projection assumptions.” In Developments in Demographic Forecasting, Chapter 3, pp. 43–62. Springer]</ref> Moreover, if the opinions of multiple experts are expressed as <math>k</math>-term metalogs, the consensus opinion may be calculated as a <math>k</math>-term metalog in closed form, where the <math>\boldsymbol a</math>-coefficients of the consensus metalog are simply a weighted average of those of the individual experts.<ref name="KeelinHoward"/> This result follows from [[Vincent average|Vincentization]], where the consensus quantile function is a weighted average of individual quantile functions.

===Bayesian Updating in Closed Form===
In a classic paper, Howard (1970)<ref>{{Cite journal|last=Howard|first=Ronald A.|date=1970|title=Decision analysis: Perspectives on inference, decision, and experimentation|journal=Proceedings of the IEEE|volume=58|issue=5|pages=632–643|doi=10.1109/PROC.1970.7719}}</ref> shows how the [[beta-binomial distribution]] can be used to update, according to [[Bayes rule]] in closed form, uncertainty over the long-run frequency <math>\phi</math> of a coin toss coming up "heads" in light of new coin-toss data. In contrast, if the uncertainty of interest to be updated is defined not by a scalar probability over a discrete event (like the result of a coin toss) but by a probability density function over a continuous variable, metalog Bayesian updating may be used. Under certain conditions, metalog quantile parameters and <math>\boldsymbol a</math>-coefficients may be updated in closed form in light of new data according to [[Bayes rule]].<ref name="KeelinHoward"/> 

== Applications ==
[[File:FishWeightMetalog.png|thumb|For 3,474 steelhead trout caught and released on the Babine River in British Columbia during 2006-2010, empirical weight data (histogram) and 10-term log metalog PDF (blue curve) fit to this data by least squares.|480x480 px]]
Due to their shape and bounds flexibility, metalogs can be used to represent empirical or other data in virtually any field of human endeavor.
* <u>Astronomy</u>. Metalogs were applied to assess the risks of asteroid impact.<ref>{{cite journal | url=https://doi.org/10.1111/risa.12453 | doi=10.1111/risa.12453 | title=Asteroid Risk Assessment: A Probabilistic Approach | year=2016 | last1=Reinhardt | first1=Jason C. | last2=Chen | first2=Xi | last3=Liu | first3=Wenhao | last4=Manchev | first4=Petar | last5=Paté-Cornell | first5=M. Elisabeth | journal=Risk Analysis | volume=36 | issue=2 | pages=244–261 | pmid=26215051 | bibcode=2016RiskA..36..244R | s2cid=23308354 | url-access=subscription }}</ref>
* <u>Cybersecurity</u>. Metalogs were used in cyber security risk assessment.<ref name="Faber" /><ref>{{cite journal | url=https://www.sciencedirect.com/science/article/pii/S0167404819300604 | doi=10.1016/j.cose.2019.101659 | title=A Bayesian network approach for cybersecurity risk assessment implementing and extending the FAIR model | year=2020 | last1=Wang | first1=Jiali | last2=Neil | first2=Martin | last3=Fenton | first3=Norman | journal=Computers & Security | volume=89 | page=101659 | s2cid=209099797 | url-access=subscription }}</ref>
* <u>Eliciting and combining expert opinion</u>. [[Statistics Canada]] elicited expert opinions on future Canadian fertility rates from 18 experts, which included the use of spreadsheet-based real-time PDF feedback based on five-term metalogs. The individual expert opinions were then weighted and combined into an overall metalog-based forecast.<ref name="statCan"/>
* <u>Empirical data exploration and visualization</u>. In fish biology, a 10-term log metalog distribution (bounded below at 0) was fit to the weights of 3,474 steelhead trout caught and released on the Babine River in British Columbia during 2006–2010. The bimodality of the resulting distribution has been attributed to the presence of both first-time and second-time spawners in the river, the latter of which tend to weigh more.<ref>{{cite journal | url=https://doi.org/10.1287/deca.2016.0338 | doi=10.1287/deca.2016.0338 | title=The Metalog Distributions | year=2016 | last1=Keelin | first1=Thomas W. | journal=Decision Analysis | volume=13 | issue=4 | pages=243–277 | url-access=subscription }}</ref>
* <u>Hydrology</u>. A 10-term semi-bounded metalog was used to model the probability distribution of annual river gauge heights.<ref>{{cite journal | url=https://doi.org/10.1287/deca.2016.0338 | doi=10.1287/deca.2016.0338 | title=The Metalog Distributions | year=2016 | last1=Keelin | first1=Thomas W. | journal=Decision Analysis | volume=13 | issue=4 | pages=243–277 | url-access=subscription }}</ref>
* <u>Oil field production</u>. Semi-bounded SPT metalogs were used to analyze biases in projections of oil-field production when compared to observed production after the fact.<ref>{{Cite journal |url=https://www.onepetro.org/journal-paper/SPE-195914-PA |doi=10.2118/195914-PA |title=Production Forecasting: Optimistic and Overconfident—Over and over Again |year=2020 |last1=Bratvold |first1=Reidar B. |last2=Mohus |first2=Erlend |last3=Petutschnig |first3=David |last4=Bickel |first4=Eric |journal=Spe Reservoir Evaluation & Engineering |volume=23 |issue=3 |pages=0799–0810 |s2cid=219661316 |url-access=subscription }}</ref>
* <u>Portfolio management</u>. SPT metalogs have been used to model commercial value of new products and product portfolios.<ref>{{Cite web|title=SmartOrg Portfolio Manager|url=https://smartorg.com/portfolio-navigator|access-date=2021-02-13|website=www.smartorg.com}}</ref>
* <u>Simulation input distributions</u>. To support a bidding decision, uncertainty about the future value of each of 259 financial assets was represented as an SPT metalog. A simulation of total portfolio value was shown to yield more realistic results than a corresponding simulation based on discrete low, median, and high values for each asset.<ref name="sim">{{cite journal | url=https://doi.org/10.1287/deca.2016.0338 | doi=10.1287/deca.2016.0338 | title=The Metalog Distributions | year=2016 | last1=Keelin | first1=Thomas W. | journal=Decision Analysis | volume=13 | issue=4 | pages=243–277 | url-access=subscription }}</ref>
* <u>Simulation output distributions</u>. Metalogs have also been used to fit output data from simulations in order to represent those outputs as closed-form continuous distributions (both CDFs and PDFs). Used in this way, they are typically more stable and smoother than histograms.<ref name="sim" />
* <u>Sums of lognormals</u>. Metalogs enable a closed-form representation of known distributions whose CDFs have no closed-form expression. Keelin et al. (2019)<ref name="sumLog"/> apply this to the sum of independent identically distributed lognormal distributions, where quantiles of the sum can be determined by a large number of simulations. Nine such quantiles are used to parameterize a semi-bounded metalog distribution that runs through each of these nine quantiles exactly. Quantile parameters are stored in a table, which can then be interpolated to yield in-between values; these values are guaranteed to be feasible by the convexity property above.

[[File:MetalogPanel.png|thumb|Metalog panel for steelhead weight data|480x480 px]]

==Choosing number of terms==
For a given application and data set, choosing the number of metalog terms <math>k</math> depends on context and may require judgment. For expert elicitation, three to five terms is usually sufficient. For data exploration and matching other probability distributions such as the sum of lognormals, eight to 12 terms is usually sufficient. A metalog panel, which displays the metalog PDFs corresponding to differing numbers of terms <math>k</math> for a given data set, may aid this judgment. For example, in the steelhead weight metalog panel,<ref name=":0" /> using less than seven terms arguably underfits the data by obscuring the data's inherent bimodality. Using more than 11 terms is unnecessary and could, in principle, [[overfitting|overfit]] the data. The case with 16 terms is infeasible for this data set, as indicated by the blank cell in the metalog panel. Other tools, such as [[regularization (mathematics)|regularization]] and [[model selection]] ([[Akaike information criterion]] and [[Bayesian information criteria|Bayesian information criterion]]) may also be useful. For example, when applied to the steelhead weight data, the AIC ranking of metalog distributions from 2-16 terms along with a wide range of classical distributions identifies the 11-term log metalog as the best fit to this data. A similar BIC ranking identifies the 10-term log metalog as the best fit. Keelin (2016)<ref name=":0" /> offers further perspectives on the distribution selection within the metalog family.<ref>{{cite journal | url=https://doi.org/10.1287/deca.2016.0338 | doi=10.1287/deca.2016.0338 | title=The Metalog Distributions | year=2016 | last1=Keelin | first1=Thomas W. | journal=Decision Analysis | volume=13 | issue=4 | at=Section 6.3, pp. 274–275 | url-access=subscription }}</ref>

==Related distributions==

The metalog distributions belong to the group of distributions defined in terms of the [[quantile function]], which include the [[quantile-parameterized distribution]]s, the [[Tukey lambda distribution]], its generalization, GLD,<ref>{{Cite journal|last1=Ramberg|first1=John S.|last2=Schmeiser|first2=Bruce W.|date=1974-02-01|title=An approximate method for generating asymmetric random variables|journal=Communications of the ACM|volume=17|issue=2|pages=78–82|doi=10.1145/360827.360840|s2cid=2640548 |issn=0001-0782|doi-access=free}}</ref> the Govindarajulu distribution<ref>{{Cite journal|last1=Nair|first1=N. Unnikrishnan|last2=Sankaran|first2=P. G.|last3=Vineshkumar|first3=B.|date=2012-12-15|title=The Govindarajulu Distribution: Some Properties and Applications|url=http://dx.doi.org/10.1080/03610926.2011.573168|journal=Communications in Statistics - Theory and Methods|volume=41|issue=24|pages=4391–4406|doi=10.1080/03610926.2011.573168|s2cid=121096603 |issn=0361-0926|url-access=subscription}}</ref> and others.<ref name=":2">{{Cite book|url=https://www.taylorfrancis.com/books/statistical-modelling-quantile-functions-warren-gilchrist/10.1201/9781420035919|title=Statistical Modelling with Quantile Functions|date=2000-05-15|publisher=Chapman and Hall/CRC|isbn=978-0-429-11920-0|language=en|doi=10.1201/9781420035919|last1=Gilchrist |first1=Warren }}</ref> The following distributions are subsumed within the metalog family:
* The [[logistic distribution]] is a special case of the unbounded metalog where <math>a_i = 0</math> for all <math>i>2</math>.
* The [[continuous uniform distribution|uniform distribution]] is a special case of: 1) the unbounded metalog where <math>k\geq4</math>, <math>a_1 = 0.5</math>, <math>a_4=1</math> and <math>a_i=0</math> otherwise; and 2) the bounded metalog where <math>k\geq2</math>, <math>b_l = 0</math>, <math>b_u = 1</math>, <math>a_2 = 1</math>, and <math>a_i=0</math> otherwise.
* The [[log-logistic distribution]], also known as the Fisk distribution in economics, is a special case of the log metalog where <math>b_l = 0</math>, and <math>a_i = 0</math> for all <math>i>2</math>.
* The [[log-uniform distribution]] is a special case of the log metalog where <math>k\geq4</math>, <math>a_1 = 0.5</math>, <math>a_4=1</math>, and <math>a_i=0</math> otherwise.
* The logit-logistic distribution<ref>{{cite journal | doi=10.1139/x05-057 | title=Tree diameter distribution modelling: Introducing the logit–logistic distribution | year=2005 | last1=Wang | first1=Mingliang | last2=Rennolls | first2=Keith | journal=Canadian Journal of Forest Research | volume=35 | issue=6 | pages=1305–1313 }}</ref> is a special case of the logit metalog where <math>a_i = 0</math> for all <math>i>2</math>.

==Software==
Freely available software tools can be used to work with metalog distributions:
* Excel workbooks. By pasting or typing in CDF data, metalogs (with choice of bounds) are instantly displayed.
** SPT metalogs workbook<ref>{{Cite web|title=SPT metalogs Excel workbook|url=http://www.metalogdistributions.com/software/sptmetalogsworkbook.html|access-date=2021-02-13|website=www.metalogdistributions.com}}</ref> calculates 2–3 term metalogs determined by three <math>(x_i,y_i)</math> CDF data.
** Metalogs workbook<ref>{{Cite web|title=Metalogs workbook|url=http://www.metalogdistributions.com/software/metalogsworkbook.html|access-date=2021-02-13|website=www.metalogdistributions.com}}</ref> calculates 2–16 term metalogs (including metalog panel) determined by 2-10,000 <math>(x_i,y_i)</math> CDF data.
** ELD (equally likely data) Metalog workbooks<ref>{{Cite web|title=ELD metalogs workbook|url=http://www.metalogdistributions.com/software/eldmetalogsworkbooks.html|access-date=2021-02-13|website=www.metalogdistributions.com}}</ref> calculate 2–16 term metalogs determined by 2–10,000 <math>(x_i)</math> CDF data, where <math>y_i</math>'s and metalog panel are automatically calculated. 
* R. [https://cran.r-project.org/web/packages/rmetalog/index.html rmetalog]<ref>[https://github.com/isaacfab/rmetalog rmetalog R package]</ref> (on [[R package#Comprehensive R Archive Network (CRAN)|Complehensive R Archive Network, CRAN]]).
* Python. Pymetalog<ref>[https://github.com/tjefferies/pymetalog Pymetalog Python package]</ref> closely mirrors the R package. Metalogistic<ref>[https://github.com/tadamcz/metalogistic/ Metalogistic Python package]</ref> takes advantage of the [[SciPy]] platform.
* [https://makedistribution.com/ MakeDistribution.com]<ref>[http://makedistribution.com/ MakeDistribution.com website supporting metalog experimentation.]</ref> facilitates experimentation with metalogs parameterized by several CDF data points. The SPT metalog calculator,<ref>[https://onedrive.live.com/embed?resid=878038A69261FF71%212608&authkey=%21AH4xQeXCJ3I59ic&em=2&AllowTyping=True&ActiveCell=%27SPT%20metalogs%27!A1&wdDownloadButton=True&wdInConfigurator=True Online SPT metalog calculator.]</ref> metalog calculator<ref>[https://onedrive.live.com/embed?resid=878038A69261FF71%212606&authkey=%21AJqZo0Fasgc9e2c&em=2&AllowTyping=True&ActiveCell=%27metalog%27!C31&wdDownloadButton=True&wdInConfigurator=True Online metalog calculator.]</ref> and ELD metalog calculator<ref>[https://onedrive.live.com/embed?resid=878038A69261FF71%212605&authkey=%21ANTgMznDG03hTIQ&em=2&AllowTyping=True&ActiveCell=%27%20ELD%20metalog%27!C31&wdDownloadButton=True&wdInConfigurator=True Online ELD metalog calculator.]</ref> are online versions of the Excel Workbooks.
* SIPmath Modeler Tools<ref>[https://www.probabilitymanagement.org/tools SIPmath Modeler Tools Excel add-in]</ref> support metalog distributions in an Excel add-In for simulation.
* Lumina's Analytica Free 101 software<ref>[https://lumina.com/ Analytica Free 101 software aids modeling of difficult decisions.]</ref> for modeling and aiding difficult decisions.
* BayesFusion's Metalog Builder <ref>[https://metalog.bayesfusion.com/ BayesFusion's Metalog Builder for interactive building of metalog distributions]</ref> allows for interactive building of metalog distributions. BayesFusion's GeNIe <ref>[https://www.bayesfusion.com/genie/ BayesFusion's GeNIe]</ref> (academic version of the software is free for academic research and teaching) implements the metalog distributions.

Commercially available packages also support the use of metalog distributions:
* FrontLine Solvers: Analytic Solver, RASON, and Solver SDK,<ref>[https://www.solver.com/ FrontLine Solvers: Analytic Solver, RASON, and Solver SDK software for optimization.]</ref> software for optimization. Automatically fits user data to the full range of (bounded and unbounded, multi-term) metalog distributions and provides option to compare metalog distributions with classical distributions based on user-selected goodness of fit criteria.
* Lone Star Analysis: TruNavigator and AnalyticsOS software <ref>[https://www.lone-star.com/ Lone Star Analysis: TruNavigator and AnalyticsOS for predictive and prescriptive analytics.]</ref> for predictive and prescriptive analytics.

== References ==
{{Reflist|30em}}

== External links ==
* The Metalog Distributions website, [http://www.metalogs.org www.metalogs.org]
* The Metalog Distributions YouTube channel, [https://www.youtube.com/channel/UCyHZ5neKhV1mSsedzDBoqyA educational videos]
[[Category:Continuous distributions]]
[[Category:Systems of probability distributions]]
